<!-- 차트 시각화 데이터 (숨김) -->
<div id="chartDataContainer" data-chart-json="{{ chart_data | tojson | forceescape }}"
    data-birth-date="{{ chart_data.birth_date }}" style="display:none;"></div>

<!-- 결과 컨테이너 -->
<div class="animate-fade-in" style="font-family: 'Noto Serif KR', serif;">

    <!-- Professional Analysis Summary (Sect & Profection) -->
    <div class="analysis-summary" style="margin-bottom:24px; display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div
            style="background:#f0f4f8; padding:12px; border-radius:4px; border-left:4px solid #2563eb; border:1px solid #1a1a1a;">
            <div style="font-size:10px; font-weight:700; color:#555; text-transform:uppercase; margin-bottom:5px;">Sect
                & Ruler</div>
            <div style="font-size:14px; font-weight:600;" id="sectRulerSummary">분석중...</div>
        </div>
        <div
            style="background:#fffcf0; padding:12px; border-radius:4px; border-left:4px solid #eab308; border:1px solid #1a1a1a;">
            <div style="font-size:10px; font-weight:700; color:#555; text-transform:uppercase; margin-bottom:5px;">
                Annual Profection</div>
            <div style="font-size:14px; font-weight:600;" id="profectionSummary">올해의 테마 확인중</div>
        </div>
    </div>

    <!-- Key Summaries (Classical Cards) -->
    <div class="summary-row">
        <!-- Sun -->
        <div class="kpi-card" style="border:1px solid #1a1a1a;" onmouseenter="highlightPlanet('Sun')"
            onmouseleave="highlightPlanet(null)">
            <div class="kpi-icon" style="color:#d97706">☉</div>
            <div class="kpi-value">{{ chart_data.planets | selectattr("name", "equalto", "Sun") |
                map(attribute="sign_ko") | first }}</div>
            <div class="kpi-label">태양 (Sun)</div>
        </div>
        <!-- Moon -->
        <div class="kpi-card" style="border:1px solid #1a1a1a;" onmouseenter="highlightPlanet('Moon')"
            onmouseleave="highlightPlanet(null)">
            <div class="kpi-icon" style="color:#666">☾</div>
            <div class="kpi-value">{{ chart_data.planets | selectattr("name", "equalto", "Moon") |
                map(attribute="sign_ko") | first }}</div>
            <div class="kpi-label">달 (Moon)</div>
        </div>
        <!-- Ascendant -->
        <div class="kpi-card" style="border:1px solid #1a1a1a;">
            <div class="kpi-icon" style="color:#9A2121; font-weight:bold; font-size:20px;">ASC</div>
            <div class="kpi-value">{{ chart_data.ascendant.sign_ko }}</div>
            <div class="kpi-label">상승궁 (Rising)</div>
        </div>
    </div>

    <!-- 저장 버튼 영역 -->
    <div style="text-align: right; margin-bottom: 24px;">
        <button class="btn-outline" hx-post="/htmx/save" hx-include="#chartForm" hx-target="#historyList"
            hx-swap="innerHTML"
            style="border:1px solid #1a1a1a; color:#1a1a1a; font-family: 'Noto Serif KR', serif; font-weight:600; padding:8px 16px; cursor:pointer;">
            기록 저장 (Save)
        </button>
    </div>

    <style>
        .element-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .el-fire {
            background: #e44b4b;
            box-shadow: 0 0 4px rgba(228, 75, 75, 0.4);
        }

        .el-earth {
            background: #3a7d44;
            box-shadow: 0 0 4px rgba(58, 125, 68, 0.4);
        }

        .el-air {
            background: #d9a106;
            box-shadow: 0 0 4px rgba(217, 161, 6, 0.4);
        }

        .el-water {
            background: #366dbb;
            box-shadow: 0 0 4px rgba(54, 109, 187, 0.4);
        }
    </style>

    <!-- Planet List (Korean Table) -->
    <div class="section-label"
        style="font-family:'Noto Serif KR', serif; color:#1a1a1a; border-bottom:2px solid #1a1a1a; padding-bottom:8px; font-weight:600; margin-top:12px;">
        천체 및 민감점 상세 (Detailed Positions)
    </div>

    <div style="border: 1px solid #1a1a1a; border-top:none; background:#fff;">
        <!-- Header -->
        <div class="data-table-row"
            style="background:#f9f9f9; border-bottom:1px solid #1a1a1a; font-weight:600; font-size:12px; color:#555;">
            <div class="col-planet">천체/포인트</div>
            <div class="col-sign">별자리 (Element)</div>
            <div class="col-deg">도수 (Degree)</div>
            <div class="col-house">실</div>
        </div>

        <!-- ASC -->
        <div class="data-table-row" style="border-bottom:1px solid #eee; background:#fffdfd;">
            <div class="col-planet" style="font-size:14px; font-weight:700; color:#9A2121;">
                <span style="width:24px; display:inline-block; text-align:center; font-size:10px;">ASC</span> 상승궁
            </div>
            <div class="col-sign" style="font-size:13px; color:#444;">
                <span class="element-dot el-{{ chart_data.ascendant.element }}"></span> {{ chart_data.ascendant.sign_ko
                }}
            </div>
            <div class="col-deg" style="font-weight:600;">{{ chart_data.ascendant.degree_formatted }}</div>
            <div class="col-house" style="color:#666;">1실</div>
        </div>

        <!-- MC -->
        <div class="data-table-row" style="border-bottom:1px solid #eee; background:#fffdfd;">
            <div class="col-planet" style="font-size:14px; font-weight:700; color:#9A2121;">
                <span style="width:24px; display:inline-block; text-align:center; font-size:10px;">MC</span> 중천점
            </div>
            <div class="col-sign" style="font-size:13px; color:#444;">
                <span class="element-dot el-{{ chart_data.midheaven.element }}"></span> {{ chart_data.midheaven.sign_ko
                }}
            </div>
            <div class="col-deg" style="font-weight:600;">{{ chart_data.midheaven.degree_formatted }}</div>
            <div class="col-house" style="color:#666;">10실</div>
        </div>

        {% for p in chart_data.planets %}
        <div class="data-table-row" style="border-bottom:1px solid #eee;" onmouseenter="highlightPlanet('{{ p.name }}')"
            onmouseleave="highlightPlanet(null)">
            <div class="col-planet" style="font-family:'Noto Serif KR', serif; font-size:14px; color:#1a1a1a;">
                <span class="planet-symbol"
                    style="color:#1a1a1a; width:24px; display:inline-block; text-align:center; font-size:18px;">{{
                    p.symbol }}</span>
                {{ p.name_ko }}
            </div>

            <div class="col-sign" style="font-family:'Noto Serif KR', serif; font-size:13px; color:#444;">
                <span class="element-dot el-{{ p.element }}"></span> {{ p.sign_ko }}
            </div>

            <div class="col-deg" style="font-family:'Inter', sans-serif; font-weight:600; color:#1a1a1a;">{{
                p.degree_formatted }}</div>
            <div class="col-house" style="font-family:'Noto Serif KR', serif; color:#666;">{{ p.house }}실</div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    if (typeof drawChartFromHtmx === 'function') {
        drawChartFromHtmx();
    }
</script>